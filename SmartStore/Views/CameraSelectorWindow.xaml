<Window x:Class="SmartStorePOS.Views.CameraSelectorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SmartStorePOS.Views"
        xmlns:converters="clr-namespace:SmartStorePOS.Converters"
        mc:Ignorable="d" 
        Title="{Binding Title}"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        SizeToContent="WidthAndHeight"
        MinWidth="450" MinHeight="400"
        Background="{StaticResource BackgroundBrush}">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Title -->
        <TextBlock Grid.Row="0" 
                   Text="{Binding Title}" 
                   FontSize="20" 
                   FontWeight="SemiBold" 
                   Foreground="{StaticResource TextPrimaryBrush}"
                   Margin="0,0,0,20"
                   HorizontalAlignment="Center"/>

        <!-- Camera List Header -->
        <TextBlock Grid.Row="1" 
                   Text="Available Cameras" 
                   FontSize="16" 
                   FontWeight="SemiBold" 
                   Foreground="{StaticResource TextPrimaryBrush}"
                   Margin="0,0,0,10"/>

        <!-- Camera List -->
        <Border Grid.Row="2" 
                Style="{StaticResource Card}"
                Margin="0,0,0,15">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <ListBox Grid.Row="0"
                         ItemsSource="{Binding CameraDevices}"
                         SelectedItem="{Binding SelectedCamera}"
                         DisplayMemberPath="Name"
                         BorderThickness="0"
                         Background="Transparent"
                         Margin="0,0,0,10">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem" BasedOn="{StaticResource ModernListBoxItem}"/>
                    </ListBox.ItemContainerStyle>
                </ListBox>

                <Button Grid.Row="1"
                        Content="Refresh Camera List"
                        Command="{Binding RefreshCamerasCommand}"
                        HorizontalAlignment="Right"
                        Style="{StaticResource TextButton}"/>
            </Grid>
        </Border>

        <!-- IP Camera URL -->
        <Grid Grid.Row="3" Margin="0,0,0,15">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0" 
                       Text="IP Camera URL:" 
                       FontSize="14" 
                       VerticalAlignment="Center"
                       Margin="0,0,10,0"
                       Foreground="{StaticResource TextPrimaryBrush}"/>
            <TextBox Grid.Column="1" 
                     Text="{Binding IpUrl, UpdateSourceTrigger=PropertyChanged}"
                     VerticalAlignment="Center"
                     Style="{StaticResource ModernTextBox}"
                     MinWidth="200"
                     Margin="0,0,0,5"
                     ToolTip="Enter or edit the IP camera URL (e.g., http://192.168.4.1:8080/)"/>
        </Grid>

        <!-- Preview Section -->
        <Grid Grid.Row="4" Margin="0,0,0,20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <TextBlock Grid.Row="0" 
                       Text="Preview" 
                       FontSize="16" 
                       FontWeight="SemiBold" 
                       Foreground="{StaticResource TextPrimaryBrush}"
                       Margin="0,0,0,10"/>

            <Border Grid.Row="1" 
                    Style="{StaticResource Card}"
                    Height="200">
                <Grid>
                    <Image Source="{Binding PreviewImage}" 
                           Stretch="Uniform"
                           RenderOptions.BitmapScalingMode="HighQuality"
                           Visibility="{Binding IsPreviewAvailable, Converter={StaticResource BooleanToVisibilityConverter}}"/>

                    <TextBlock Text="No camera selected or preview not available"
                               Visibility="{Binding IsPreviewAvailable, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               Foreground="{StaticResource TextSecondaryBrush}"/>

                    <Button Content="Start Preview" 
                            Command="{Binding StartPreviewCommand}"
                            Style="{StaticResource PrimaryButton}"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Bottom"
                            Margin="0,0,0,10"
                            Visibility="{Binding IsPreviewActive, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>

                    <Button Content="Stop Preview" 
                            Command="{Binding StopPreviewCommand}"
                            Style="{StaticResource SecondaryButton}"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Bottom"
                            Margin="0,0,0,10"
                            Visibility="{Binding IsPreviewActive, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                </Grid>
            </Border>
        </Grid>

        <!-- Buttons -->
        <StackPanel Grid.Row="5" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right">
            <Button Content="Select Camera" 
                    Command="{Binding SelectCameraCommand}"
                    Style="{StaticResource PrimaryButton}"
                    Margin="0,0,10,0"
                    IsEnabled="{Binding CanSelectCamera}"/>
            <Button Content="Cancel" 
                    Command="{Binding CancelCommand}"
                    Style="{StaticResource SecondaryButton}"/>
        </StackPanel>
    </Grid>
</Window>